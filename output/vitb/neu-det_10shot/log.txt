[12/22 20:10:32] detectron2 INFO: Rank of current process: 0. World size: 4
[12/22 20:10:33] detectron2 INFO: Environment info:
----------------------  ----------------------------------------------------------------------------------------------
sys.platform            linux
Python                  3.9.23 | packaged by conda-forge | (main, Jun  4 2025, 17:57:12) [GCC 13.3.0]
numpy                   1.22.4
detectron2              RegionCLIP @/data2/user/2025/flf/project_zyh/CDFSOD-benchmark/tools/../detectron2
Compiler                GCC 10.5
CUDA compiler           CUDA 11.8
detectron2 arch flags   8.6
DETECTRON2_ENV_MODULE   <not set>
PyTorch                 1.13.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torch
PyTorch debug build     False
GPU available           True
GPU 0,1,2,3             NVIDIA GeForce RTX 4090 (arch=8.9)
CUDA_HOME               /usr/local/cuda-11.8
Pillow                  9.5.0
torchvision             0.14.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torchvision
torchvision arch flags  3.5, 5.0, 6.0, 7.0, 7.5, 8.0, 8.6
fvcore                  0.1.5.post20221221
iopath                  0.1.8
cv2                     Not found
----------------------  ----------------------------------------------------------------------------------------------
PyTorch built with:
  - GCC 9.3
  - C++ Version: 201402
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v2.6.0 (Git Hash 52b5f107dd9cf10910aaa19cb47f3abf9b349815)
  - OpenMP 201511 (a.k.a. OpenMP 4.5)
  - LAPACK is enabled (usually provided by MKL)
  - NNPACK is enabled
  - CPU capability usage: AVX2
  - CUDA Runtime 11.7
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_80,code=sm_80;-gencode;arch=compute_86,code=sm_86
  - CuDNN 8.9.7  (built against CUDA 11.8)
    - Built with CuDNN 8.5
  - Magma 2.6.1
  - Build settings: BLAS_INFO=mkl, BUILD_TYPE=Release, CUDA_VERSION=11.7, CUDNN_VERSION=8.5.0, CXX_COMPILER=/opt/rh/devtoolset-9/root/usr/bin/c++, CXX_FLAGS= -fabi-version=11 -Wno-deprecated -fvisibility-inlines-hidden -DUSE_PTHREADPOOL -fopenmp -DNDEBUG -DUSE_KINETO -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DSYMBOLICATE_MOBILE_DEBUG_HANDLE -DEDGE_PROFILER_USE_KINETO -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Werror=non-virtual-dtor -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wunused-local-typedefs -Wno-unused-parameter -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-psabi -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Werror=cast-function-type -Wno-stringop-overflow, LAPACK_INFO=mkl, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, TORCH_VERSION=1.13.1, USE_CUDA=ON, USE_CUDNN=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_ROCM=OFF, 

[12/22 20:10:33] detectron2 INFO: Command line arguments: Namespace(config_file='configs/neu-det/vitb_shot10_neu-det_finetune.yaml', resume=False, eval_only=False, num_gpus=4, controller=False, num_machines=1, machine_rank=0, dist_url='auto', opts=['MODEL.WEIGHTS', 'weights/trained/few-shot/vitb_0089999.pth', 'DE.OFFLINE_RPN_CONFIG', 'configs/RPN/mask_rcnn_R_50_C4_1x_ovd_FSD.yaml', 'OUTPUT_DIR', 'output/vitb/neu-det_10shot/'])
[12/22 20:10:33] detectron2 INFO: Contents of args.config_file=configs/neu-det/vitb_shot10_neu-det_finetune.yaml:
_BASE_: ../Base-RCNN-C4.yaml
DE:
  CLASS_PROTOTYPES: prototypes_init/NEUDET_10shot.vitb14.bbox.p10.sk.pkl
  BG_PROTOTYPES: weights/initial/background/background_prototypes.vitb14.pth
  BG_CLS_LOSS_WEIGHT: 0.2
  TOPK: 5
  SET_CD_VITO: true
  ATTN_FUSE_RATIO: 0.7
MODEL:
  META_ARCHITECTURE: OpenSetDetectorWithExamples
  BACKBONE:
    NAME: build_dino_v2_vit
    TYPE: base    # base, small
  WEIGHTS: ''
  MASK_ON: false
  RPN:
    HEAD_NAME: StandardRPNHead
    IN_FEATURES: [res4]
  ROI_HEADS:
    SCORE_THRESH_TEST: 0.001
  ROI_BOX_HEAD:
    NAME: ''
    NUM_FC: 0
    POOLER_RESOLUTION: 7
    CLS_AGNOSTIC_BBOX_REG: true
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
DATASETS:
  TRAIN: ("NEUDET_10shot",)
  TEST: ("NEUDET_test",)
TEST:
  EVAL_PERIOD: 200
SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.002
  STEPS: (120, 180)
  MAX_ITER: 200
  WARMUP_ITERS: 50
  CHECKPOINT_PERIOD: 200
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: RGB


[12/22 20:10:34] detectron2 INFO: Full config saved to output/vitb/neu-det_10shot/config.yaml
[12/22 22:29:23] detectron2 INFO: Rank of current process: 0. World size: 4
[12/22 22:29:23] detectron2 INFO: Environment info:
----------------------  ----------------------------------------------------------------------------------------------
sys.platform            linux
Python                  3.9.23 | packaged by conda-forge | (main, Jun  4 2025, 17:57:12) [GCC 13.3.0]
numpy                   1.22.4
detectron2              RegionCLIP @/data2/user/2025/flf/project_zyh/CDFSOD-benchmark/tools/../detectron2
Compiler                GCC 10.5
CUDA compiler           CUDA 11.8
detectron2 arch flags   8.6
DETECTRON2_ENV_MODULE   <not set>
PyTorch                 1.13.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torch
PyTorch debug build     False
GPU available           True
GPU 0,1,2,3             NVIDIA GeForce RTX 4090 (arch=8.9)
CUDA_HOME               /usr/local/cuda-11.8
Pillow                  9.5.0
torchvision             0.14.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torchvision
torchvision arch flags  3.5, 5.0, 6.0, 7.0, 7.5, 8.0, 8.6
fvcore                  0.1.5.post20221221
iopath                  0.1.8
cv2                     Not found
----------------------  ----------------------------------------------------------------------------------------------
PyTorch built with:
  - GCC 9.3
  - C++ Version: 201402
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v2.6.0 (Git Hash 52b5f107dd9cf10910aaa19cb47f3abf9b349815)
  - OpenMP 201511 (a.k.a. OpenMP 4.5)
  - LAPACK is enabled (usually provided by MKL)
  - NNPACK is enabled
  - CPU capability usage: AVX2
  - CUDA Runtime 11.7
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_80,code=sm_80;-gencode;arch=compute_86,code=sm_86
  - CuDNN 8.9.7  (built against CUDA 11.8)
    - Built with CuDNN 8.5
  - Magma 2.6.1
  - Build settings: BLAS_INFO=mkl, BUILD_TYPE=Release, CUDA_VERSION=11.7, CUDNN_VERSION=8.5.0, CXX_COMPILER=/opt/rh/devtoolset-9/root/usr/bin/c++, CXX_FLAGS= -fabi-version=11 -Wno-deprecated -fvisibility-inlines-hidden -DUSE_PTHREADPOOL -fopenmp -DNDEBUG -DUSE_KINETO -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DSYMBOLICATE_MOBILE_DEBUG_HANDLE -DEDGE_PROFILER_USE_KINETO -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Werror=non-virtual-dtor -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wunused-local-typedefs -Wno-unused-parameter -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-psabi -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Werror=cast-function-type -Wno-stringop-overflow, LAPACK_INFO=mkl, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, TORCH_VERSION=1.13.1, USE_CUDA=ON, USE_CUDNN=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_ROCM=OFF, 

[12/22 22:29:23] detectron2 INFO: Command line arguments: Namespace(config_file='configs/neu-det/vitb_shot10_neu-det_finetune.yaml', resume=False, eval_only=False, num_gpus=4, controller=False, num_machines=1, machine_rank=0, dist_url='auto', opts=['MODEL.WEIGHTS', 'weights/trained/few-shot/vitb_0089999.pth', 'DE.OFFLINE_RPN_CONFIG', 'configs/RPN/mask_rcnn_R_50_C4_1x_ovd_FSD.yaml', 'OUTPUT_DIR', 'output/vitb/neu-det_10shot/'])
[12/22 22:29:23] detectron2 INFO: Contents of args.config_file=configs/neu-det/vitb_shot10_neu-det_finetune.yaml:
_BASE_: ../Base-RCNN-C4.yaml
DE:
  CLASS_PROTOTYPES: prototypes_init/NEUDET_10shot.vitb14.bbox.p10.sk.pkl
  BG_PROTOTYPES: weights/initial/background/background_prototypes.vitb14.pth
  BG_CLS_LOSS_WEIGHT: 0.2
  TOPK: 5
  SET_CD_VITO: true
  ATTN_FUSE_RATIO: 0.7
MODEL:
  META_ARCHITECTURE: OpenSetDetectorWithExamples
  BACKBONE:
    NAME: build_dino_v2_vit
    TYPE: base    # base, small
  WEIGHTS: ''
  MASK_ON: false
  RPN:
    HEAD_NAME: StandardRPNHead
    IN_FEATURES: [res4]
  ROI_HEADS:
    SCORE_THRESH_TEST: 0.001
  ROI_BOX_HEAD:
    NAME: ''
    NUM_FC: 0
    POOLER_RESOLUTION: 7
    CLS_AGNOSTIC_BBOX_REG: true
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
DATASETS:
  TRAIN: ("NEUDET_10shot",)
  TEST: ("NEUDET_test",)
TEST:
  EVAL_PERIOD: 200
SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.002
  STEPS: (120, 180)
  MAX_ITER: 200
  WARMUP_ITERS: 50
  CHECKPOINT_PERIOD: 200
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: RGB


[12/22 22:29:23] detectron2 INFO: Full config saved to output/vitb/neu-det_10shot/config.yaml
[12/22 22:29:28] d2.data.datasets.coco INFO: Loaded 60 images in COCO format from datasets/NEUDET/annotations/10_shot.json
[12/22 22:29:28] d2.data.build INFO: Removed 0 images with no usable annotations. 60 images left.
[12/22 22:29:28] d2.data.build INFO: Distribution of instances among all 6 categories:
[36m|   category    | #instances   |   category    | #instances   |  category  | #instances   |
|:-------------:|:-------------|:-------------:|:-------------|:----------:|:-------------|
|    crazing    | 10           |   inclusion   | 10           |  patches   | 10           |
| pitted_surf.. | 10           | rolled-in_s.. | 10           | scratches  | 10           |
|               |              |               |              |            |              |
|     total     | 60           |               |              |            |              |[0m
[12/22 22:29:28] d2.data.dataset_mapper INFO: [DatasetMapper] Augmentations used in training: [ResizeShortestEdge(short_edge_length=(640, 672, 704, 736, 768, 800), max_size=1333, sample_style='choice'), RandomFlip()]
[12/22 22:29:28] d2.data.build INFO: Using training sampler TrainingSampler
[12/22 22:29:29] d2.data.common INFO: Serializing 60 elements to byte tensors and concatenating them all ...
[12/22 22:29:29] d2.data.common INFO: Serialized dataset takes 0.01 MiB
[12/22 22:29:29] fvcore.common.checkpoint INFO: [Checkpointer] Loading from weights/trained/few-shot/vitb_0089999.pth ...
[12/22 22:29:30] fvcore.common.checkpoint WARNING: Skip loading parameter 'test_class_weight' to the model due to incompatible shapes: (80, 768) in the checkpoint but (6, 768) in the model! You might want to double check if this is expected.
[12/22 22:29:30] fvcore.common.checkpoint WARNING: Some model parameters or buffers are not found in the checkpoint:
[34madapter.proto_center_attn.attention_weights.0.{bias, weight}[0m
[34madapter.proto_center_attn.fc.{bias, weight}[0m
[34mbg_tokens.weight[0m
[34mclass_weights.weight[0m
[34mdomain_prompter.weight[0m
[34mprototype_classifier.linear.{bias, weight}[0m
[34mtest_class_weight[0m
[12/22 22:29:30] fvcore.common.checkpoint WARNING: The checkpoint state_dict contains keys that are not used by the model:
  [35mtrain_class_weight[0m
[12/22 22:29:30] d2.engine.train_loop INFO: Starting training from iteration 0
[12/22 22:29:54] d2.utils.events INFO:  eta: 0:02:30  iter: 19  roi_cover_ratio: 0.729  cls_acc: 0.8291  fg_cls_acc: 0.6509  false_neg_ratio: 0.196  total_loss: 7.109  aux_bce_loss_0: 0.3859  aux_dice_loss_0: 0.226  rg_l1_loss_0: 0.07341  aux_bce_loss_1: 0.3545  aux_dice_loss_1: 0.195  rg_l1_loss_1: 0.0638  aux_bce_loss_2: 0.3395  aux_dice_loss_2: 0.1813  rg_l1_loss_2: 0.05858  aux_bce_loss_3: 0.3237  aux_dice_loss_3: 0.1744  rg_l1_loss_3: 0.05631  aux_bce_loss_4: 0.3237  aux_dice_loss_4: 0.167  rg_l1_loss_4: 0.054  focal_loss_0: 0.1465  focal_loss_1: 0.1197  focal_loss_2: 0.1045  bbox_loss: 0.22  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.795  proto_contrastive_loss: 1.707  time: 0.8395  data_time: 0.3512  lr: 0.00076124  max_mem: 3242M
[12/22 22:30:11] d2.utils.events INFO:  eta: 0:02:15  iter: 39  roi_cover_ratio: 0.6106  cls_acc: 0.9111  fg_cls_acc: 0.8965  false_neg_ratio: 0.1035  total_loss: 6.105  aux_bce_loss_0: 0.3117  aux_dice_loss_0: 0.1771  rg_l1_loss_0: 0.0578  aux_bce_loss_1: 0.2736  aux_dice_loss_1: 0.1535  rg_l1_loss_1: 0.04776  aux_bce_loss_2: 0.2464  aux_dice_loss_2: 0.1399  rg_l1_loss_2: 0.04277  aux_bce_loss_3: 0.2258  aux_dice_loss_3: 0.1316  rg_l1_loss_3: 0.03887  aux_bce_loss_4: 0.2193  aux_dice_loss_4: 0.1258  rg_l1_loss_4: 0.03718  focal_loss_0: 0.07525  focal_loss_1: 0.06584  focal_loss_2: 0.06241  bbox_loss: 0.1599  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.786  proto_contrastive_loss: 1.706  time: 0.8413  data_time: 0.0062  lr: 0.0015604  max_mem: 3242M
[12/22 22:30:28] d2.utils.events INFO:  eta: 0:01:58  iter: 59  roi_cover_ratio: 0.6435  cls_acc: 0.9268  fg_cls_acc: 0.8863  false_neg_ratio: 0.1137  total_loss: 5.589  aux_bce_loss_0: 0.2829  aux_dice_loss_0: 0.1566  rg_l1_loss_0: 0.05327  aux_bce_loss_1: 0.2307  aux_dice_loss_1: 0.1251  rg_l1_loss_1: 0.03957  aux_bce_loss_2: 0.1995  aux_dice_loss_2: 0.1082  rg_l1_loss_2: 0.03506  aux_bce_loss_3: 0.1828  aux_dice_loss_3: 0.09966  rg_l1_loss_3: 0.03242  aux_bce_loss_4: 0.1742  aux_dice_loss_4: 0.09466  rg_l1_loss_4: 0.02982  focal_loss_0: 0.04699  focal_loss_1: 0.04079  focal_loss_2: 0.038  bbox_loss: 0.1244  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.768  proto_contrastive_loss: 1.704  time: 0.8469  data_time: 0.0061  lr: 0.002  max_mem: 3366M
[12/22 22:30:45] d2.utils.events INFO:  eta: 0:01:41  iter: 79  roi_cover_ratio: 0.6693  cls_acc: 0.9492  fg_cls_acc: 0.9731  false_neg_ratio: 0.02695  total_loss: 5.368  aux_bce_loss_0: 0.263  aux_dice_loss_0: 0.1512  rg_l1_loss_0: 0.05255  aux_bce_loss_1: 0.207  aux_dice_loss_1: 0.1202  rg_l1_loss_1: 0.03745  aux_bce_loss_2: 0.1805  aux_dice_loss_2: 0.1011  rg_l1_loss_2: 0.0312  aux_bce_loss_3: 0.1633  aux_dice_loss_3: 0.09052  rg_l1_loss_3: 0.02802  aux_bce_loss_4: 0.1553  aux_dice_loss_4: 0.08635  rg_l1_loss_4: 0.02641  focal_loss_0: 0.03938  focal_loss_1: 0.03248  focal_loss_2: 0.03047  bbox_loss: 0.1044  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.744  proto_contrastive_loss: 1.704  time: 0.8476  data_time: 0.0056  lr: 0.002  max_mem: 3366M
[12/22 22:31:02] d2.utils.events INFO:  eta: 0:01:24  iter: 99  roi_cover_ratio: 0.6512  cls_acc: 0.96  fg_cls_acc: 0.9646  false_neg_ratio: 0.03542  total_loss: 5.083  aux_bce_loss_0: 0.235  aux_dice_loss_0: 0.141  rg_l1_loss_0: 0.04833  aux_bce_loss_1: 0.1838  aux_dice_loss_1: 0.1067  rg_l1_loss_1: 0.03366  aux_bce_loss_2: 0.1522  aux_dice_loss_2: 0.08754  rg_l1_loss_2: 0.02795  aux_bce_loss_3: 0.1351  aux_dice_loss_3: 0.07614  rg_l1_loss_3: 0.02472  aux_bce_loss_4: 0.1272  aux_dice_loss_4: 0.07234  rg_l1_loss_4: 0.02308  focal_loss_0: 0.03221  focal_loss_1: 0.02612  focal_loss_2: 0.02398  bbox_loss: 0.09416  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.721  proto_contrastive_loss: 1.703  time: 0.8474  data_time: 0.0063  lr: 0.002  max_mem: 3366M
[12/22 22:31:19] d2.utils.events INFO:  eta: 0:01:07  iter: 119  roi_cover_ratio: 0.6103  cls_acc: 0.9619  fg_cls_acc: 0.9704  false_neg_ratio: 0.02965  total_loss: 4.952  aux_bce_loss_0: 0.232  aux_dice_loss_0: 0.1379  rg_l1_loss_0: 0.04683  aux_bce_loss_1: 0.1705  aux_dice_loss_1: 0.09929  rg_l1_loss_1: 0.03108  aux_bce_loss_2: 0.1393  aux_dice_loss_2: 0.07946  rg_l1_loss_2: 0.02524  aux_bce_loss_3: 0.1199  aux_dice_loss_3: 0.06714  rg_l1_loss_3: 0.02233  aux_bce_loss_4: 0.1165  aux_dice_loss_4: 0.06473  rg_l1_loss_4: 0.02062  focal_loss_0: 0.02964  focal_loss_1: 0.0247  focal_loss_2: 0.02333  bbox_loss: 0.08316  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.695  proto_contrastive_loss: 1.701  time: 0.8486  data_time: 0.0063  lr: 0.002  max_mem: 3366M
[12/22 22:31:36] d2.utils.events INFO:  eta: 0:00:50  iter: 139  roi_cover_ratio: 0.6972  cls_acc: 0.9668  fg_cls_acc: 0.977  false_neg_ratio: 0.02302  total_loss: 4.737  aux_bce_loss_0: 0.2027  aux_dice_loss_0: 0.1269  rg_l1_loss_0: 0.04254  aux_bce_loss_1: 0.1521  aux_dice_loss_1: 0.08913  rg_l1_loss_1: 0.02712  aux_bce_loss_2: 0.1222  aux_dice_loss_2: 0.0693  rg_l1_loss_2: 0.02056  aux_bce_loss_3: 0.1063  aux_dice_loss_3: 0.05986  rg_l1_loss_3: 0.01799  aux_bce_loss_4: 0.09946  aux_dice_loss_4: 0.05764  rg_l1_loss_4: 0.01634  focal_loss_0: 0.0258  focal_loss_1: 0.02157  focal_loss_2: 0.02077  bbox_loss: 0.0686  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.68  proto_contrastive_loss: 1.7  time: 0.8488  data_time: 0.0053  lr: 0.0002  max_mem: 3366M
[12/22 22:31:53] d2.utils.events INFO:  eta: 0:00:33  iter: 159  roi_cover_ratio: 0.671  cls_acc: 0.958  fg_cls_acc: 0.9823  false_neg_ratio: 0.01771  total_loss: 4.63  aux_bce_loss_0: 0.2025  aux_dice_loss_0: 0.1286  rg_l1_loss_0: 0.03937  aux_bce_loss_1: 0.1442  aux_dice_loss_1: 0.08829  rg_l1_loss_1: 0.02478  aux_bce_loss_2: 0.1123  aux_dice_loss_2: 0.06606  rg_l1_loss_2: 0.01836  aux_bce_loss_3: 0.09429  aux_dice_loss_3: 0.05613  rg_l1_loss_3: 0.01594  aux_bce_loss_4: 0.08724  aux_dice_loss_4: 0.05311  rg_l1_loss_4: 0.01423  focal_loss_0: 0.02565  focal_loss_1: 0.02138  focal_loss_2: 0.01976  bbox_loss: 0.05923  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.679  proto_contrastive_loss: 1.701  time: 0.8480  data_time: 0.0060  lr: 0.0002  max_mem: 3366M
[12/22 22:32:10] d2.utils.events INFO:  eta: 0:00:16  iter: 179  roi_cover_ratio: 0.6913  cls_acc: 0.9629  fg_cls_acc: 0.9683  false_neg_ratio: 0.03175  total_loss: 4.603  aux_bce_loss_0: 0.2009  aux_dice_loss_0: 0.1212  rg_l1_loss_0: 0.03847  aux_bce_loss_1: 0.1437  aux_dice_loss_1: 0.08329  rg_l1_loss_1: 0.02554  aux_bce_loss_2: 0.1103  aux_dice_loss_2: 0.0629  rg_l1_loss_2: 0.01834  aux_bce_loss_3: 0.09551  aux_dice_loss_3: 0.053  rg_l1_loss_3: 0.0156  aux_bce_loss_4: 0.08613  aux_dice_loss_4: 0.05091  rg_l1_loss_4: 0.0136  focal_loss_0: 0.02572  focal_loss_1: 0.02056  focal_loss_2: 0.01832  bbox_loss: 0.06002  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.676  proto_contrastive_loss: 1.7  time: 0.8476  data_time: 0.0062  lr: 0.0002  max_mem: 3366M
[12/22 22:32:27] fvcore.common.checkpoint INFO: Saving checkpoint to output/vitb/neu-det_10shot/model_0000199.pth
[12/22 22:32:28] fvcore.common.checkpoint INFO: Saving checkpoint to output/vitb/neu-det_10shot/model_final.pth
[12/22 22:32:28] d2.utils.events INFO:  eta: 0:00:00  iter: 199  roi_cover_ratio: 0.6028  cls_acc: 0.9658  fg_cls_acc: 0.9813  false_neg_ratio: 0.01869  total_loss: 4.609  aux_bce_loss_0: 0.1992  aux_dice_loss_0: 0.1277  rg_l1_loss_0: 0.03928  aux_bce_loss_1: 0.1352  aux_dice_loss_1: 0.08441  rg_l1_loss_1: 0.02379  aux_bce_loss_2: 0.1073  aux_dice_loss_2: 0.06276  rg_l1_loss_2: 0.0181  aux_bce_loss_3: 0.09137  aux_dice_loss_3: 0.05381  rg_l1_loss_3: 0.01563  aux_bce_loss_4: 0.08531  aux_dice_loss_4: 0.05026  rg_l1_loss_4: 0.01377  focal_loss_0: 0.02482  focal_loss_1: 0.02068  focal_loss_2: 0.0191  bbox_loss: 0.05859  domain_prompter_contrasitive_loss: 0.0005365  prototype_cls_loss: 1.672  proto_contrastive_loss: 1.7  time: 0.8466  data_time: 0.0056  lr: 2e-05  max_mem: 3366M
[12/22 22:32:28] d2.engine.hooks INFO: Overall training speed: 198 iterations in 0:02:47 (0.8466 s / it)
[12/22 22:32:28] d2.engine.hooks INFO: Total training time: 0:02:49 (0:00:01 on hooks)
[12/22 22:32:28] d2.data.datasets.coco INFO: Loaded 360 images in COCO format from datasets/NEUDET/annotations/test.json
[12/22 22:32:28] d2.data.build INFO: Distribution of instances among all 6 categories:
[36m|   category    | #instances   |   category    | #instances   |  category  | #instances   |
|:-------------:|:-------------|:-------------:|:-------------|:----------:|:-------------|
|    crazing    | 103          |   inclusion   | 159          |  patches   | 222          |
| pitted_surf.. | 106          | rolled-in_s.. | 141          | scratches  | 103          |
|               |              |               |              |            |              |
|     total     | 834          |               |              |            |              |[0m
[12/22 22:32:28] d2.data.dataset_mapper INFO: [DatasetMapper] Augmentations used in inference: [ResizeShortestEdge(short_edge_length=(800, 800), max_size=1333, sample_style='choice')]
[12/22 22:32:28] d2.data.common INFO: Serializing 360 elements to byte tensors and concatenating them all ...
[12/22 22:32:28] d2.data.common INFO: Serialized dataset takes 0.12 MiB
[12/22 22:32:28] d2.evaluation.evaluator INFO: Start inference on 90 batches
[12/22 22:32:51] d2.evaluation.evaluator INFO: Inference done 11/90. Dataloading: 0.0011 s / iter. Inference: 0.4395 s / iter. Eval: 0.0003 s / iter. Total: 0.4408 s / iter. ETA=0:00:34
[12/22 22:32:57] d2.evaluation.evaluator INFO: Inference done 21/90. Dataloading: 0.0013 s / iter. Inference: 0.5000 s / iter. Eval: 0.0003 s / iter. Total: 0.5016 s / iter. ETA=0:00:34
[12/22 22:33:02] d2.evaluation.evaluator INFO: Inference done 34/90. Dataloading: 0.0014 s / iter. Inference: 0.4666 s / iter. Eval: 0.0003 s / iter. Total: 0.4684 s / iter. ETA=0:00:26
[12/22 22:33:07] d2.evaluation.evaluator INFO: Inference done 45/90. Dataloading: 0.0014 s / iter. Inference: 0.4636 s / iter. Eval: 0.0003 s / iter. Total: 0.4654 s / iter. ETA=0:00:20
[12/22 22:33:12] d2.evaluation.evaluator INFO: Inference done 57/90. Dataloading: 0.0014 s / iter. Inference: 0.4543 s / iter. Eval: 0.0003 s / iter. Total: 0.4561 s / iter. ETA=0:00:15
[12/22 22:33:18] d2.evaluation.evaluator INFO: Inference done 69/90. Dataloading: 0.0014 s / iter. Inference: 0.4495 s / iter. Eval: 0.0003 s / iter. Total: 0.4513 s / iter. ETA=0:00:09
[12/22 22:33:23] d2.evaluation.evaluator INFO: Inference done 81/90. Dataloading: 0.0014 s / iter. Inference: 0.4480 s / iter. Eval: 0.0003 s / iter. Total: 0.4498 s / iter. ETA=0:00:04
[12/23 16:20:37] detectron2 INFO: Rank of current process: 0. World size: 1
[12/23 16:20:38] detectron2 INFO: Environment info:
----------------------  ----------------------------------------------------------------------------------------------
sys.platform            linux
Python                  3.9.23 | packaged by conda-forge | (main, Jun  4 2025, 17:57:12) [GCC 13.3.0]
numpy                   1.22.4
detectron2              RegionCLIP @/data2/user/2025/flf/project_zyh/CDFSOD-benchmark/tools/../detectron2
Compiler                GCC 10.5
CUDA compiler           CUDA 11.8
detectron2 arch flags   8.6
DETECTRON2_ENV_MODULE   <not set>
PyTorch                 1.13.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torch
PyTorch debug build     False
GPU available           True
GPU 0                   NVIDIA GeForce RTX 4090 (arch=8.9)
CUDA_HOME               /usr/local/cuda-11.8
Pillow                  9.5.0
torchvision             0.14.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torchvision
torchvision arch flags  3.5, 5.0, 6.0, 7.0, 7.5, 8.0, 8.6
fvcore                  0.1.5.post20221221
iopath                  0.1.8
cv2                     Not found
----------------------  ----------------------------------------------------------------------------------------------
PyTorch built with:
  - GCC 9.3
  - C++ Version: 201402
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v2.6.0 (Git Hash 52b5f107dd9cf10910aaa19cb47f3abf9b349815)
  - OpenMP 201511 (a.k.a. OpenMP 4.5)
  - LAPACK is enabled (usually provided by MKL)
  - NNPACK is enabled
  - CPU capability usage: AVX2
  - CUDA Runtime 11.7
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_80,code=sm_80;-gencode;arch=compute_86,code=sm_86
  - CuDNN 8.9.7  (built against CUDA 11.8)
    - Built with CuDNN 8.5
  - Magma 2.6.1
  - Build settings: BLAS_INFO=mkl, BUILD_TYPE=Release, CUDA_VERSION=11.7, CUDNN_VERSION=8.5.0, CXX_COMPILER=/opt/rh/devtoolset-9/root/usr/bin/c++, CXX_FLAGS= -fabi-version=11 -Wno-deprecated -fvisibility-inlines-hidden -DUSE_PTHREADPOOL -fopenmp -DNDEBUG -DUSE_KINETO -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DSYMBOLICATE_MOBILE_DEBUG_HANDLE -DEDGE_PROFILER_USE_KINETO -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Werror=non-virtual-dtor -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wunused-local-typedefs -Wno-unused-parameter -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-psabi -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Werror=cast-function-type -Wno-stringop-overflow, LAPACK_INFO=mkl, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, TORCH_VERSION=1.13.1, USE_CUDA=ON, USE_CUDNN=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_ROCM=OFF, 

[12/23 16:20:38] detectron2 INFO: Command line arguments: Namespace(config_file='configs/neu-det/vitb_shot10_neu-det_finetune.yaml', resume=False, eval_only=True, num_gpus=1, controller=False, num_machines=1, machine_rank=0, dist_url='auto', opts=['MODEL.WEIGHTS', 'output/vitb/neu-det_10shot/model_final.pth', 'OUTPUT_DIR', 'output/vitb/neu-det_10shot/'])
[12/23 16:20:38] detectron2 INFO: Contents of args.config_file=configs/neu-det/vitb_shot10_neu-det_finetune.yaml:
_BASE_: ../Base-RCNN-C4.yaml
DE:
  CLASS_PROTOTYPES: prototypes_init/NEUDET_10shot.vitb14.bbox.p10.sk.pkl
  BG_PROTOTYPES: weights/initial/background/background_prototypes.vitb14.pth
  BG_CLS_LOSS_WEIGHT: 0.2
  TOPK: 5
  SET_CD_VITO: true
  ATTN_FUSE_RATIO: 0.7
MODEL:
  META_ARCHITECTURE: OpenSetDetectorWithExamples
  BACKBONE:
    NAME: build_dino_v2_vit
    TYPE: base    # base, small
  WEIGHTS: ''
  MASK_ON: false
  RPN:
    HEAD_NAME: StandardRPNHead
    IN_FEATURES: [res4]
  ROI_HEADS:
    SCORE_THRESH_TEST: 0.001
  ROI_BOX_HEAD:
    NAME: ''
    NUM_FC: 0
    POOLER_RESOLUTION: 7
    CLS_AGNOSTIC_BBOX_REG: true
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
DATASETS:
  TRAIN: ("NEUDET_10shot",)
  TEST: ("NEUDET_test",)
TEST:
  EVAL_PERIOD: 200
SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.002
  STEPS: (120, 180)
  MAX_ITER: 200
  WARMUP_ITERS: 50
  CHECKPOINT_PERIOD: 200
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: RGB


[12/23 16:20:38] detectron2 INFO: Full config saved to output/vitb/neu-det_10shot/config.yaml
[12/23 16:34:51] detectron2 INFO: Rank of current process: 0. World size: 1
[12/23 16:34:52] detectron2 INFO: Environment info:
----------------------  ----------------------------------------------------------------------------------------------
sys.platform            linux
Python                  3.9.23 | packaged by conda-forge | (main, Jun  4 2025, 17:57:12) [GCC 13.3.0]
numpy                   1.22.4
detectron2              RegionCLIP @/data2/user/2025/flf/project_zyh/CDFSOD-benchmark/tools/../detectron2
Compiler                GCC 10.5
CUDA compiler           CUDA 11.8
detectron2 arch flags   8.6
DETECTRON2_ENV_MODULE   <not set>
PyTorch                 1.13.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torch
PyTorch debug build     False
GPU available           True
GPU 0                   NVIDIA GeForce RTX 4090 (arch=8.9)
CUDA_HOME               /usr/local/cuda-11.8
Pillow                  9.5.0
torchvision             0.14.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torchvision
torchvision arch flags  3.5, 5.0, 6.0, 7.0, 7.5, 8.0, 8.6
fvcore                  0.1.5.post20221221
iopath                  0.1.8
cv2                     Not found
----------------------  ----------------------------------------------------------------------------------------------
PyTorch built with:
  - GCC 9.3
  - C++ Version: 201402
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v2.6.0 (Git Hash 52b5f107dd9cf10910aaa19cb47f3abf9b349815)
  - OpenMP 201511 (a.k.a. OpenMP 4.5)
  - LAPACK is enabled (usually provided by MKL)
  - NNPACK is enabled
  - CPU capability usage: AVX2
  - CUDA Runtime 11.7
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_80,code=sm_80;-gencode;arch=compute_86,code=sm_86
  - CuDNN 8.9.7  (built against CUDA 11.8)
    - Built with CuDNN 8.5
  - Magma 2.6.1
  - Build settings: BLAS_INFO=mkl, BUILD_TYPE=Release, CUDA_VERSION=11.7, CUDNN_VERSION=8.5.0, CXX_COMPILER=/opt/rh/devtoolset-9/root/usr/bin/c++, CXX_FLAGS= -fabi-version=11 -Wno-deprecated -fvisibility-inlines-hidden -DUSE_PTHREADPOOL -fopenmp -DNDEBUG -DUSE_KINETO -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DSYMBOLICATE_MOBILE_DEBUG_HANDLE -DEDGE_PROFILER_USE_KINETO -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Werror=non-virtual-dtor -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wunused-local-typedefs -Wno-unused-parameter -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-psabi -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Werror=cast-function-type -Wno-stringop-overflow, LAPACK_INFO=mkl, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, TORCH_VERSION=1.13.1, USE_CUDA=ON, USE_CUDNN=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_ROCM=OFF, 

[12/23 16:34:52] detectron2 INFO: Command line arguments: Namespace(config_file='configs/neu-det/vitb_shot10_neu-det_finetune.yaml', resume=False, eval_only=True, num_gpus=1, controller=False, num_machines=1, machine_rank=0, dist_url='auto', opts=['MODEL.WEIGHTS', 'output/vitb/neu-det_10shot/model_final.pth', 'DE.OFFLINE_RPN_CONFIG', 'configs/RPN/mask_rcnn_R_50_C4_1x_ovd_FSD.yaml', 'OUTPUT_DIR', 'output/vitb/neu-det_10shot/'])
[12/23 16:34:52] detectron2 INFO: Contents of args.config_file=configs/neu-det/vitb_shot10_neu-det_finetune.yaml:
_BASE_: ../Base-RCNN-C4.yaml
DE:
  CLASS_PROTOTYPES: prototypes_init/NEUDET_10shot.vitb14.bbox.p10.sk.pkl
  BG_PROTOTYPES: weights/initial/background/background_prototypes.vitb14.pth
  BG_CLS_LOSS_WEIGHT: 0.2
  TOPK: 5
  SET_CD_VITO: true
  ATTN_FUSE_RATIO: 0.7
MODEL:
  META_ARCHITECTURE: OpenSetDetectorWithExamples
  BACKBONE:
    NAME: build_dino_v2_vit
    TYPE: base    # base, small
  WEIGHTS: ''
  MASK_ON: false
  RPN:
    HEAD_NAME: StandardRPNHead
    IN_FEATURES: [res4]
  ROI_HEADS:
    SCORE_THRESH_TEST: 0.001
  ROI_BOX_HEAD:
    NAME: ''
    NUM_FC: 0
    POOLER_RESOLUTION: 7
    CLS_AGNOSTIC_BBOX_REG: true
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
DATASETS:
  TRAIN: ("NEUDET_10shot",)
  TEST: ("NEUDET_test",)
TEST:
  EVAL_PERIOD: 200
SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.002
  STEPS: (120, 180)
  MAX_ITER: 200
  WARMUP_ITERS: 50
  CHECKPOINT_PERIOD: 200
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: RGB


[12/23 16:34:52] detectron2 INFO: Full config saved to output/vitb/neu-det_10shot/config.yaml
[12/23 16:34:57] fvcore.common.checkpoint INFO: [Checkpointer] Loading from output/vitb/neu-det_10shot/model_final.pth ...
[12/23 16:34:58] d2.data.datasets.coco INFO: Loaded 360 images in COCO format from datasets/NEUDET/annotations/test.json
[12/23 16:34:58] d2.data.build INFO: Distribution of instances among all 6 categories:
|   category    | #instances   |   category    | #instances   |  category  | #instances   |
|:-------------:|:-------------|:-------------:|:-------------|:----------:|:-------------|
|    crazing    | 103          |   inclusion   | 159          |  patches   | 222          |
| pitted_surf.. | 106          | rolled-in_s.. | 141          | scratches  | 103          |
|               |              |               |              |            |              |
|     total     | 834          |               |              |            |              |
[12/23 16:34:58] d2.data.dataset_mapper INFO: [DatasetMapper] Augmentations used in inference: [ResizeShortestEdge(short_edge_length=(800, 800), max_size=1333, sample_style='choice')]
[12/23 16:34:58] d2.data.common INFO: Serializing 360 elements to byte tensors and concatenating them all ...
[12/23 16:34:58] d2.data.common INFO: Serialized dataset takes 0.12 MiB
[12/23 16:34:58] d2.evaluation.evaluator INFO: Start inference on 360 batches
[12/23 16:35:04] d2.evaluation.evaluator INFO: Inference done 11/360. Dataloading: 0.0011 s / iter. Inference: 0.4384 s / iter. Eval: 0.0003 s / iter. Total: 0.4397 s / iter. ETA=0:02:33
[12/23 16:35:09] d2.evaluation.evaluator INFO: Inference done 20/360. Dataloading: 0.0014 s / iter. Inference: 0.5078 s / iter. Eval: 0.0003 s / iter. Total: 0.5095 s / iter. ETA=0:02:53
[12/23 16:35:14] d2.evaluation.evaluator INFO: Inference done 33/360. Dataloading: 0.0014 s / iter. Inference: 0.4603 s / iter. Eval: 0.0003 s / iter. Total: 0.4620 s / iter. ETA=0:02:31
[12/23 16:35:19] d2.evaluation.evaluator INFO: Inference done 44/360. Dataloading: 0.0014 s / iter. Inference: 0.4652 s / iter. Eval: 0.0003 s / iter. Total: 0.4671 s / iter. ETA=0:02:27
[12/23 16:35:25] d2.evaluation.evaluator INFO: Inference done 56/360. Dataloading: 0.0014 s / iter. Inference: 0.4603 s / iter. Eval: 0.0003 s / iter. Total: 0.4621 s / iter. ETA=0:02:20
[12/23 16:35:30] d2.evaluation.evaluator INFO: Inference done 68/360. Dataloading: 0.0015 s / iter. Inference: 0.4556 s / iter. Eval: 0.0003 s / iter. Total: 0.4574 s / iter. ETA=0:02:13
[12/23 16:35:35] d2.evaluation.evaluator INFO: Inference done 80/360. Dataloading: 0.0015 s / iter. Inference: 0.4510 s / iter. Eval: 0.0003 s / iter. Total: 0.4528 s / iter. ETA=0:02:06
[12/23 16:35:40] d2.evaluation.evaluator INFO: Inference done 93/360. Dataloading: 0.0015 s / iter. Inference: 0.4420 s / iter. Eval: 0.0003 s / iter. Total: 0.4438 s / iter. ETA=0:01:58
[12/23 16:35:46] d2.evaluation.evaluator INFO: Inference done 104/360. Dataloading: 0.0032 s / iter. Inference: 0.4473 s / iter. Eval: 0.0003 s / iter. Total: 0.4508 s / iter. ETA=0:01:55
[12/23 16:35:51] d2.evaluation.evaluator INFO: Inference done 115/360. Dataloading: 0.0031 s / iter. Inference: 0.4514 s / iter. Eval: 0.0003 s / iter. Total: 0.4548 s / iter. ETA=0:01:51
[12/23 16:35:56] d2.evaluation.evaluator INFO: Inference done 128/360. Dataloading: 0.0029 s / iter. Inference: 0.4464 s / iter. Eval: 0.0003 s / iter. Total: 0.4497 s / iter. ETA=0:01:44
[12/23 16:36:02] d2.evaluation.evaluator INFO: Inference done 139/360. Dataloading: 0.0028 s / iter. Inference: 0.4478 s / iter. Eval: 0.0003 s / iter. Total: 0.4510 s / iter. ETA=0:01:39
[12/23 16:36:07] d2.evaluation.evaluator INFO: Inference done 149/360. Dataloading: 0.0027 s / iter. Inference: 0.4514 s / iter. Eval: 0.0003 s / iter. Total: 0.4544 s / iter. ETA=0:01:35
[12/23 19:41:53] detectron2 INFO: Rank of current process: 0. World size: 4
[12/23 19:41:54] detectron2 INFO: Environment info:
----------------------  ----------------------------------------------------------------------------------------------
sys.platform            linux
Python                  3.9.23 | packaged by conda-forge | (main, Jun  4 2025, 17:57:12) [GCC 13.3.0]
numpy                   1.22.4
detectron2              RegionCLIP @/data2/user/2025/flf/project_zyh/CDFSOD-benchmark/tools/../detectron2
Compiler                GCC 10.5
CUDA compiler           CUDA 11.8
detectron2 arch flags   8.6
DETECTRON2_ENV_MODULE   <not set>
PyTorch                 1.13.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torch
PyTorch debug build     False
GPU available           True
GPU 0,1,2,3             NVIDIA GeForce RTX 4090 (arch=8.9)
CUDA_HOME               /usr/local/cuda-11.8
Pillow                  9.5.0
torchvision             0.14.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torchvision
torchvision arch flags  3.5, 5.0, 6.0, 7.0, 7.5, 8.0, 8.6
fvcore                  0.1.5.post20221221
iopath                  0.1.8
cv2                     Not found
----------------------  ----------------------------------------------------------------------------------------------
PyTorch built with:
  - GCC 9.3
  - C++ Version: 201402
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v2.6.0 (Git Hash 52b5f107dd9cf10910aaa19cb47f3abf9b349815)
  - OpenMP 201511 (a.k.a. OpenMP 4.5)
  - LAPACK is enabled (usually provided by MKL)
  - NNPACK is enabled
  - CPU capability usage: AVX2
  - CUDA Runtime 11.7
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_80,code=sm_80;-gencode;arch=compute_86,code=sm_86
  - CuDNN 8.9.7  (built against CUDA 11.8)
    - Built with CuDNN 8.5
  - Magma 2.6.1
  - Build settings: BLAS_INFO=mkl, BUILD_TYPE=Release, CUDA_VERSION=11.7, CUDNN_VERSION=8.5.0, CXX_COMPILER=/opt/rh/devtoolset-9/root/usr/bin/c++, CXX_FLAGS= -fabi-version=11 -Wno-deprecated -fvisibility-inlines-hidden -DUSE_PTHREADPOOL -fopenmp -DNDEBUG -DUSE_KINETO -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DSYMBOLICATE_MOBILE_DEBUG_HANDLE -DEDGE_PROFILER_USE_KINETO -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Werror=non-virtual-dtor -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wunused-local-typedefs -Wno-unused-parameter -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-psabi -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Werror=cast-function-type -Wno-stringop-overflow, LAPACK_INFO=mkl, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, TORCH_VERSION=1.13.1, USE_CUDA=ON, USE_CUDNN=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_ROCM=OFF, 

[12/23 19:41:54] detectron2 INFO: Command line arguments: Namespace(config_file='configs/neu-det/vitb_shot10_neu-det_finetune.yaml', resume=False, eval_only=True, num_gpus=4, controller=False, num_machines=1, machine_rank=0, dist_url='auto', opts=['MODEL.WEIGHTS', 'output/vitb/neu-det_10shot/model_final.pth', 'DE.OFFLINE_RPN_CONFIG', 'configs/RPN/mask_rcnn_R_50_C4_1x_ovd_FSD.yaml', 'OUTPUT_DIR', 'output/vitb/neu-det_10shot/', 'SOLVER.IMS_PER_BATCH', '4'])
[12/23 19:41:54] detectron2 INFO: Contents of args.config_file=configs/neu-det/vitb_shot10_neu-det_finetune.yaml:
_BASE_: ../Base-RCNN-C4.yaml
DE:
  CLASS_PROTOTYPES: prototypes_init/NEUDET_10shot.vitb14.bbox.p10.sk.pkl
  BG_PROTOTYPES: weights/initial/background/background_prototypes.vitb14.pth
  BG_CLS_LOSS_WEIGHT: 0.2
  TOPK: 5
  SET_CD_VITO: true
  ATTN_FUSE_RATIO: 0.7
MODEL:
  META_ARCHITECTURE: OpenSetDetectorWithExamples
  BACKBONE:
    NAME: build_dino_v2_vit
    TYPE: base    # base, small
  WEIGHTS: ''
  MASK_ON: false
  RPN:
    HEAD_NAME: StandardRPNHead
    IN_FEATURES: [res4]
  ROI_HEADS:
    SCORE_THRESH_TEST: 0.001
  ROI_BOX_HEAD:
    NAME: ''
    NUM_FC: 0
    POOLER_RESOLUTION: 7
    CLS_AGNOSTIC_BBOX_REG: true
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
DATASETS:
  TRAIN: ("NEUDET_10shot",)
  TEST: ("NEUDET_test",)
TEST:
  EVAL_PERIOD: 200
SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.002
  STEPS: (120, 180)
  MAX_ITER: 200
  WARMUP_ITERS: 50
  CHECKPOINT_PERIOD: 200
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: RGB


[12/23 19:41:54] detectron2 INFO: Full config saved to output/vitb/neu-det_10shot/config.yaml
[12/23 19:42:01] fvcore.common.checkpoint INFO: [Checkpointer] Loading from output/vitb/neu-det_10shot/model_final.pth ...
[12/23 19:42:36] d2.data.datasets.coco INFO: Loaded 360 images in COCO format from datasets/NEUDET/annotations/test.json
[12/23 19:42:36] d2.data.build INFO: Distribution of instances among all 6 categories:
|   category    | #instances   |   category    | #instances   |  category  | #instances   |
|:-------------:|:-------------|:-------------:|:-------------|:----------:|:-------------|
|    crazing    | 103          |   inclusion   | 159          |  patches   | 222          |
| pitted_surf.. | 106          | rolled-in_s.. | 141          | scratches  | 103          |
|               |              |               |              |            |              |
|     total     | 834          |               |              |            |              |
[12/23 19:42:36] d2.data.dataset_mapper INFO: [DatasetMapper] Augmentations used in inference: [ResizeShortestEdge(short_edge_length=(800, 800), max_size=1333, sample_style='choice')]
[12/23 19:42:36] d2.data.common INFO: Serializing 360 elements to byte tensors and concatenating them all ...
[12/23 19:42:36] d2.data.common INFO: Serialized dataset takes 0.12 MiB
[12/23 19:42:36] d2.evaluation.evaluator INFO: Start inference on 90 batches
[12/23 19:43:03] d2.evaluation.evaluator INFO: Inference done 11/90. Dataloading: 0.0010 s / iter. Inference: 0.8291 s / iter. Eval: 0.0003 s / iter. Total: 0.8304 s / iter. ETA=0:01:05
[12/23 19:43:09] d2.evaluation.evaluator INFO: Inference done 17/90. Dataloading: 0.0013 s / iter. Inference: 0.9195 s / iter. Eval: 0.0003 s / iter. Total: 0.9211 s / iter. ETA=0:01:07
[12/23 19:43:15] d2.evaluation.evaluator INFO: Inference done 22/90. Dataloading: 0.0013 s / iter. Inference: 0.9579 s / iter. Eval: 0.0003 s / iter. Total: 0.9596 s / iter. ETA=0:01:05
[12/23 19:43:20] d2.evaluation.evaluator INFO: Inference done 30/90. Dataloading: 0.0014 s / iter. Inference: 0.8596 s / iter. Eval: 0.0003 s / iter. Total: 0.8614 s / iter. ETA=0:00:51
[12/23 19:43:26] d2.evaluation.evaluator INFO: Inference done 36/90. Dataloading: 0.0014 s / iter. Inference: 0.8775 s / iter. Eval: 0.0003 s / iter. Total: 0.8793 s / iter. ETA=0:00:47
[12/23 19:43:31] d2.evaluation.evaluator INFO: Inference done 42/90. Dataloading: 0.0014 s / iter. Inference: 0.8701 s / iter. Eval: 0.0003 s / iter. Total: 0.8719 s / iter. ETA=0:00:41
[12/23 19:43:36] d2.evaluation.evaluator INFO: Inference done 48/90. Dataloading: 0.0014 s / iter. Inference: 0.8709 s / iter. Eval: 0.0003 s / iter. Total: 0.8727 s / iter. ETA=0:00:36
[12/23 19:43:42] d2.evaluation.evaluator INFO: Inference done 55/90. Dataloading: 0.0014 s / iter. Inference: 0.8635 s / iter. Eval: 0.0003 s / iter. Total: 0.8653 s / iter. ETA=0:00:30
[12/23 19:43:47] d2.evaluation.evaluator INFO: Inference done 61/90. Dataloading: 0.0015 s / iter. Inference: 0.8611 s / iter. Eval: 0.0003 s / iter. Total: 0.8630 s / iter. ETA=0:00:25
[12/23 19:43:52] d2.evaluation.evaluator INFO: Inference done 67/90. Dataloading: 0.0015 s / iter. Inference: 0.8638 s / iter. Eval: 0.0003 s / iter. Total: 0.8657 s / iter. ETA=0:00:19
[12/23 19:43:58] d2.evaluation.evaluator INFO: Inference done 74/90. Dataloading: 0.0014 s / iter. Inference: 0.8626 s / iter. Eval: 0.0003 s / iter. Total: 0.8644 s / iter. ETA=0:00:13
[12/23 19:44:04] d2.evaluation.evaluator INFO: Inference done 81/90. Dataloading: 0.0014 s / iter. Inference: 0.8611 s / iter. Eval: 0.0003 s / iter. Total: 0.8630 s / iter. ETA=0:00:07
[12/23 19:44:09] d2.evaluation.evaluator INFO: Inference done 88/90. Dataloading: 0.0014 s / iter. Inference: 0.8515 s / iter. Eval: 0.0003 s / iter. Total: 0.8534 s / iter. ETA=0:00:01
[12/23 19:44:30] d2.evaluation.evaluator INFO: Total inference time: 0:01:31.787689 (1.079855 s / iter per device, on 4 devices)
[12/23 19:44:30] d2.evaluation.evaluator INFO: Total inference pure compute time: 0:01:11 (0.842436 s / iter per device, on 4 devices)
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: Preparing results for COCO format ...
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: Saving results to output/vitb/neu-det_10shot/inference/coco_instances_results.json
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: Evaluating predictions with unofficial COCO API...
[12/23 19:44:36] d2.evaluation.fast_eval_api INFO: Evaluate annotation type *bbox*
[12/23 19:44:36] d2.evaluation.fast_eval_api INFO: COCOeval_opt.evaluate() finished in 0.12 seconds.
[12/23 19:44:36] d2.evaluation.fast_eval_api INFO: Accumulating evaluation results...
[12/23 19:44:36] d2.evaluation.fast_eval_api INFO: COCOeval_opt.accumulate() finished in 0.04 seconds.
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: Evaluation results for bbox: 
|   AP   |  AP50  |  AP75  |  APs  |  APm   |  APl   |
|:------:|:------:|:------:|:-----:|:------:|:------:|
| 13.075 | 33.373 | 7.560  | 0.767 | 10.932 | 20.961 |
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: target AP50: -1
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: base AP50: 0.3337253360879406
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: all AP50: 0.3337253360879406
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: target AP75: -1
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: base AP75: 0.07559728287047371
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: all AP75: 0.07559728287047371
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: target mAP: -1.0
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: base mAP: 0.13075050717901043
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: all mAP: 0.13075050717901043
[12/23 19:44:36] d2.evaluation.coco_evaluation INFO: Per-category bbox AP: 
| category       | AP     | category        | AP     | category   | AP     |
|:---------------|:-------|:----------------|:-------|:-----------|:-------|
| crazing        | 3.452  | inclusion       | 11.345 | patches    | 21.862 |
| pitted_surface | 21.250 | rolled-in_scale | 8.220  | scratches  | 12.321 |
[12/23 19:44:36] d2.engine.defaults INFO: Evaluation results for NEUDET_test in csv format:
[12/23 19:44:36] d2.evaluation.testing INFO: copypaste: Task: bbox
[12/23 19:44:36] d2.evaluation.testing INFO: copypaste: AP,AP50,AP75,APs,APm,APl
[12/23 19:44:36] d2.evaluation.testing INFO: copypaste: 13.0751,33.3725,7.5597,0.7671,10.9318,20.9613
[12/23 19:44:36] d2.evaluation.testing INFO: ###################### ('AP', 13.075050717901041) ######################
