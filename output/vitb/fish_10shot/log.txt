[12/22 19:51:07] detectron2 INFO: Rank of current process: 0. World size: 4
[12/22 19:51:08] detectron2 INFO: Environment info:
----------------------  ----------------------------------------------------------------------------------------------
sys.platform            linux
Python                  3.9.23 | packaged by conda-forge | (main, Jun  4 2025, 17:57:12) [GCC 13.3.0]
numpy                   1.22.4
detectron2              RegionCLIP @/data2/user/2025/flf/project_zyh/CDFSOD-benchmark/tools/../detectron2
Compiler                GCC 10.5
CUDA compiler           CUDA 11.8
detectron2 arch flags   8.6
DETECTRON2_ENV_MODULE   <not set>
PyTorch                 1.13.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torch
PyTorch debug build     False
GPU available           True
GPU 0,1,2,3             NVIDIA GeForce RTX 4090 (arch=8.9)
CUDA_HOME               /usr/local/cuda-11.8
Pillow                  9.5.0
torchvision             0.14.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torchvision
torchvision arch flags  3.5, 5.0, 6.0, 7.0, 7.5, 8.0, 8.6
fvcore                  0.1.5.post20221221
iopath                  0.1.8
cv2                     Not found
----------------------  ----------------------------------------------------------------------------------------------
PyTorch built with:
  - GCC 9.3
  - C++ Version: 201402
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v2.6.0 (Git Hash 52b5f107dd9cf10910aaa19cb47f3abf9b349815)
  - OpenMP 201511 (a.k.a. OpenMP 4.5)
  - LAPACK is enabled (usually provided by MKL)
  - NNPACK is enabled
  - CPU capability usage: AVX2
  - CUDA Runtime 11.7
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_80,code=sm_80;-gencode;arch=compute_86,code=sm_86
  - CuDNN 8.9.7  (built against CUDA 11.8)
    - Built with CuDNN 8.5
  - Magma 2.6.1
  - Build settings: BLAS_INFO=mkl, BUILD_TYPE=Release, CUDA_VERSION=11.7, CUDNN_VERSION=8.5.0, CXX_COMPILER=/opt/rh/devtoolset-9/root/usr/bin/c++, CXX_FLAGS= -fabi-version=11 -Wno-deprecated -fvisibility-inlines-hidden -DUSE_PTHREADPOOL -fopenmp -DNDEBUG -DUSE_KINETO -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DSYMBOLICATE_MOBILE_DEBUG_HANDLE -DEDGE_PROFILER_USE_KINETO -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Werror=non-virtual-dtor -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wunused-local-typedefs -Wno-unused-parameter -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-psabi -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Werror=cast-function-type -Wno-stringop-overflow, LAPACK_INFO=mkl, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, TORCH_VERSION=1.13.1, USE_CUDA=ON, USE_CUDNN=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_ROCM=OFF, 

[12/22 19:51:08] detectron2 INFO: Command line arguments: Namespace(config_file='configs/fish/vitb_shot10_fish_finetune.yaml', resume=False, eval_only=False, num_gpus=4, controller=False, num_machines=1, machine_rank=0, dist_url='auto', opts=['MODEL.WEIGHTS', 'weights/trained/few-shot/vitb_0089999.pth', 'DE.OFFLINE_RPN_CONFIG', 'configs/RPN/mask_rcnn_R_50_C4_1x_ovd_FSD.yaml', 'OUTPUT_DIR', 'output/vitb/fish_10shot/'])
[12/22 19:51:08] detectron2 INFO: Contents of args.config_file=configs/fish/vitb_shot10_fish_finetune.yaml:
_BASE_: ../Base-RCNN-C4.yaml
DE:
  CLASS_PROTOTYPES: prototypes_init/FISH_10shot.vitb14.bbox.p10.sk.pkl
  BG_PROTOTYPES: weights/initial/background/background_prototypes.vitb14.pth
  BG_CLS_LOSS_WEIGHT: 0.2
  TOPK: 1
  SET_CD_VITO: true
  ATTN_FUSE_RATIO: 0.7
MODEL:
  META_ARCHITECTURE: OpenSetDetectorWithExamples
  BACKBONE:
    NAME: build_dino_v2_vit
    TYPE: base    # base, small
  WEIGHTS: ''
  MASK_ON: false
  RPN:
    HEAD_NAME: StandardRPNHead
    IN_FEATURES: [res4]
  ROI_HEADS:
    SCORE_THRESH_TEST: 0.001
  ROI_BOX_HEAD:
    NAME: ''
    NUM_FC: 0
    POOLER_RESOLUTION: 7
    CLS_AGNOSTIC_BBOX_REG: true
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
DATASETS:
  TRAIN: ("FISH_10shot",)
  TEST: ("FISH_test",)
TEST:
  EVAL_PERIOD: 200
SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.001
  STEPS: (120, 180)
  MAX_ITER: 200
  WARMUP_ITERS: 100
  CHECKPOINT_PERIOD: 200
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: RGB


[12/22 19:51:08] detectron2 INFO: Full config saved to output/vitb/fish_10shot/config.yaml
[12/22 22:00:43] detectron2 INFO: Rank of current process: 0. World size: 4
[12/22 22:00:44] detectron2 INFO: Environment info:
----------------------  ----------------------------------------------------------------------------------------------
sys.platform            linux
Python                  3.9.23 | packaged by conda-forge | (main, Jun  4 2025, 17:57:12) [GCC 13.3.0]
numpy                   1.22.4
detectron2              RegionCLIP @/data2/user/2025/flf/project_zyh/CDFSOD-benchmark/tools/../detectron2
Compiler                GCC 10.5
CUDA compiler           CUDA 11.8
detectron2 arch flags   8.6
DETECTRON2_ENV_MODULE   <not set>
PyTorch                 1.13.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torch
PyTorch debug build     False
GPU available           True
GPU 0,1,2,3             NVIDIA GeForce RTX 4090 (arch=8.9)
CUDA_HOME               /usr/local/cuda-11.8
Pillow                  9.5.0
torchvision             0.14.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torchvision
torchvision arch flags  3.5, 5.0, 6.0, 7.0, 7.5, 8.0, 8.6
fvcore                  0.1.5.post20221221
iopath                  0.1.8
cv2                     Not found
----------------------  ----------------------------------------------------------------------------------------------
PyTorch built with:
  - GCC 9.3
  - C++ Version: 201402
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v2.6.0 (Git Hash 52b5f107dd9cf10910aaa19cb47f3abf9b349815)
  - OpenMP 201511 (a.k.a. OpenMP 4.5)
  - LAPACK is enabled (usually provided by MKL)
  - NNPACK is enabled
  - CPU capability usage: AVX2
  - CUDA Runtime 11.7
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_80,code=sm_80;-gencode;arch=compute_86,code=sm_86
  - CuDNN 8.9.7  (built against CUDA 11.8)
    - Built with CuDNN 8.5
  - Magma 2.6.1
  - Build settings: BLAS_INFO=mkl, BUILD_TYPE=Release, CUDA_VERSION=11.7, CUDNN_VERSION=8.5.0, CXX_COMPILER=/opt/rh/devtoolset-9/root/usr/bin/c++, CXX_FLAGS= -fabi-version=11 -Wno-deprecated -fvisibility-inlines-hidden -DUSE_PTHREADPOOL -fopenmp -DNDEBUG -DUSE_KINETO -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DSYMBOLICATE_MOBILE_DEBUG_HANDLE -DEDGE_PROFILER_USE_KINETO -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Werror=non-virtual-dtor -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wunused-local-typedefs -Wno-unused-parameter -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-psabi -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Werror=cast-function-type -Wno-stringop-overflow, LAPACK_INFO=mkl, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, TORCH_VERSION=1.13.1, USE_CUDA=ON, USE_CUDNN=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_ROCM=OFF, 

[12/22 22:00:44] detectron2 INFO: Command line arguments: Namespace(config_file='configs/fish/vitb_shot10_fish_finetune.yaml', resume=False, eval_only=False, num_gpus=4, controller=False, num_machines=1, machine_rank=0, dist_url='auto', opts=['MODEL.WEIGHTS', 'weights/trained/few-shot/vitb_0089999.pth', 'DE.OFFLINE_RPN_CONFIG', 'configs/RPN/mask_rcnn_R_50_C4_1x_ovd_FSD.yaml', 'OUTPUT_DIR', 'output/vitb/fish_10shot/'])
[12/22 22:00:44] detectron2 INFO: Contents of args.config_file=configs/fish/vitb_shot10_fish_finetune.yaml:
_BASE_: ../Base-RCNN-C4.yaml
DE:
  CLASS_PROTOTYPES: prototypes_init/FISH_10shot.vitb14.bbox.p10.sk.pkl
  BG_PROTOTYPES: weights/initial/background/background_prototypes.vitb14.pth
  BG_CLS_LOSS_WEIGHT: 0.2
  TOPK: 1
  SET_CD_VITO: true
  ATTN_FUSE_RATIO: 0.7
MODEL:
  META_ARCHITECTURE: OpenSetDetectorWithExamples
  BACKBONE:
    NAME: build_dino_v2_vit
    TYPE: base    # base, small
  WEIGHTS: ''
  MASK_ON: false
  RPN:
    HEAD_NAME: StandardRPNHead
    IN_FEATURES: [res4]
  ROI_HEADS:
    SCORE_THRESH_TEST: 0.001
  ROI_BOX_HEAD:
    NAME: ''
    NUM_FC: 0
    POOLER_RESOLUTION: 7
    CLS_AGNOSTIC_BBOX_REG: true
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
DATASETS:
  TRAIN: ("FISH_10shot",)
  TEST: ("FISH_test",)
TEST:
  EVAL_PERIOD: 200
SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.001
  STEPS: (120, 180)
  MAX_ITER: 200
  WARMUP_ITERS: 100
  CHECKPOINT_PERIOD: 200
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: RGB


[12/22 22:00:44] detectron2 INFO: Full config saved to output/vitb/fish_10shot/config.yaml
[12/22 22:00:49] d2.data.datasets.coco INFO: Loaded 10 images in COCO format from datasets/FISH/annotations/10_shot.json
[12/22 22:00:49] d2.data.build INFO: Removed 0 images with no usable annotations. 10 images left.
[12/22 22:00:49] d2.data.build INFO: Distribution of instances among all 1 categories:
[36m|  category  | #instances   |
|:----------:|:-------------|
|    fish    | 10           |
|            |              |[0m
[12/22 22:00:49] d2.data.dataset_mapper INFO: [DatasetMapper] Augmentations used in training: [ResizeShortestEdge(short_edge_length=(640, 672, 704, 736, 768, 800), max_size=1333, sample_style='choice'), RandomFlip()]
[12/22 22:00:49] d2.data.build INFO: Using training sampler TrainingSampler
[12/22 22:00:49] d2.data.common INFO: Serializing 10 elements to byte tensors and concatenating them all ...
[12/22 22:00:49] d2.data.common INFO: Serialized dataset takes 0.00 MiB
[12/22 22:00:49] fvcore.common.checkpoint INFO: [Checkpointer] Loading from weights/trained/few-shot/vitb_0089999.pth ...
[12/22 22:00:50] fvcore.common.checkpoint WARNING: Skip loading parameter 'test_class_weight' to the model due to incompatible shapes: (80, 768) in the checkpoint but (1, 768) in the model! You might want to double check if this is expected.
[12/22 22:00:50] fvcore.common.checkpoint WARNING: Some model parameters or buffers are not found in the checkpoint:
[34madapter.proto_center_attn.attention_weights.0.{bias, weight}[0m
[34madapter.proto_center_attn.fc.{bias, weight}[0m
[34mbg_tokens.weight[0m
[34mclass_weights.weight[0m
[34mtest_class_weight[0m
[12/22 22:00:50] fvcore.common.checkpoint WARNING: The checkpoint state_dict contains keys that are not used by the model:
  [35mtrain_class_weight[0m
[12/22 22:00:50] d2.engine.train_loop INFO: Starting training from iteration 0
[12/22 22:01:11] d2.utils.events INFO:  eta: 0:02:04  iter: 19  roi_cover_ratio: 0.7388  cls_acc: 0.9082  fg_cls_acc: 0.9269  false_neg_ratio: 0.07314  total_loss: 2.051  aux_bce_loss_0: 0.2647  aux_dice_loss_0: 0.1891  rg_l1_loss_0: 0.04769  aux_bce_loss_1: 0.2002  aux_dice_loss_1: 0.1398  rg_l1_loss_1: 0.03584  aux_bce_loss_2: 0.1727  aux_dice_loss_2: 0.1126  rg_l1_loss_2: 0.02922  aux_bce_loss_3: 0.1617  aux_dice_loss_3: 0.1016  rg_l1_loss_3: 0.02809  aux_bce_loss_4: 0.1598  aux_dice_loss_4: 0.09807  rg_l1_loss_4: 0.02791  focal_loss_0: 0.08895  focal_loss_1: 0.08148  focal_loss_2: 0.06842  bbox_loss: 0.1233  time: 0.6895  data_time: 0.3482  lr: 0.00019081  max_mem: 2015M
[12/22 22:01:25] d2.utils.events INFO:  eta: 0:01:51  iter: 39  roi_cover_ratio: 0.7717  cls_acc: 0.9658  fg_cls_acc: 0.9706  false_neg_ratio: 0.02943  total_loss: 1.451  aux_bce_loss_0: 0.2005  aux_dice_loss_0: 0.1397  rg_l1_loss_0: 0.03694  aux_bce_loss_1: 0.1419  aux_dice_loss_1: 0.09922  rg_l1_loss_1: 0.02464  aux_bce_loss_2: 0.1186  aux_dice_loss_2: 0.08057  rg_l1_loss_2: 0.02065  aux_bce_loss_3: 0.107  aux_dice_loss_3: 0.07353  rg_l1_loss_3: 0.01947  aux_bce_loss_4: 0.1039  aux_dice_loss_4: 0.0728  rg_l1_loss_4: 0.01923  focal_loss_0: 0.0355  focal_loss_1: 0.02183  focal_loss_2: 0.02086  bbox_loss: 0.08025  time: 0.6934  data_time: 0.0089  lr: 0.00039061  max_mem: 2015M
[12/22 22:01:39] d2.utils.events INFO:  eta: 0:01:37  iter: 59  roi_cover_ratio: 0.6918  cls_acc: 0.9717  fg_cls_acc: 1  false_neg_ratio: 0  total_loss: 0.9924  aux_bce_loss_0: 0.1699  aux_dice_loss_0: 0.1208  rg_l1_loss_0: 0.0279  aux_bce_loss_1: 0.108  aux_dice_loss_1: 0.07434  rg_l1_loss_1: 0.01708  aux_bce_loss_2: 0.07898  aux_dice_loss_2: 0.05509  rg_l1_loss_2: 0.01381  aux_bce_loss_3: 0.06654  aux_dice_loss_3: 0.04896  rg_l1_loss_3: 0.01254  aux_bce_loss_4: 0.06329  aux_dice_loss_4: 0.04834  rg_l1_loss_4: 0.01134  focal_loss_0: 0.02215  focal_loss_1: 0.01344  focal_loss_2: 0.01333  bbox_loss: 0.04535  time: 0.6944  data_time: 0.0081  lr: 0.00059041  max_mem: 2015M
[12/22 22:01:53] d2.utils.events INFO:  eta: 0:01:23  iter: 79  roi_cover_ratio: 0.6702  cls_acc: 0.9785  fg_cls_acc: 1  false_neg_ratio: 0  total_loss: 0.8164  aux_bce_loss_0: 0.1446  aux_dice_loss_0: 0.1057  rg_l1_loss_0: 0.02527  aux_bce_loss_1: 0.08778  aux_dice_loss_1: 0.06141  rg_l1_loss_1: 0.01488  aux_bce_loss_2: 0.06057  aux_dice_loss_2: 0.04408  rg_l1_loss_2: 0.01148  aux_bce_loss_3: 0.04971  aux_dice_loss_3: 0.0374  rg_l1_loss_3: 0.01079  aux_bce_loss_4: 0.04678  aux_dice_loss_4: 0.03818  rg_l1_loss_4: 0.009687  focal_loss_0: 0.01515  focal_loss_1: 0.01127  focal_loss_2: 0.01071  bbox_loss: 0.03936  time: 0.6947  data_time: 0.0086  lr: 0.00079021  max_mem: 2069M
[12/22 22:02:07] d2.utils.events INFO:  eta: 0:01:09  iter: 99  roi_cover_ratio: 0.75  cls_acc: 0.9844  fg_cls_acc: 1  false_neg_ratio: 0  total_loss: 0.7075  aux_bce_loss_0: 0.1292  aux_dice_loss_0: 0.09273  rg_l1_loss_0: 0.02197  aux_bce_loss_1: 0.07321  aux_dice_loss_1: 0.05188  rg_l1_loss_1: 0.01284  aux_bce_loss_2: 0.05051  aux_dice_loss_2: 0.03576  rg_l1_loss_2: 0.01077  aux_bce_loss_3: 0.04075  aux_dice_loss_3: 0.02973  rg_l1_loss_3: 0.01024  aux_bce_loss_4: 0.0387  aux_dice_loss_4: 0.02943  rg_l1_loss_4: 0.008994  focal_loss_0: 0.01449  focal_loss_1: 0.009766  focal_loss_2: 0.00961  bbox_loss: 0.03424  time: 0.6969  data_time: 0.0089  lr: 0.00099001  max_mem: 2069M
[12/22 22:02:21] d2.utils.events INFO:  eta: 0:00:55  iter: 119  roi_cover_ratio: 0.6824  cls_acc: 0.9863  fg_cls_acc: 1  false_neg_ratio: 0  total_loss: 0.6386  aux_bce_loss_0: 0.1155  aux_dice_loss_0: 0.08741  rg_l1_loss_0: 0.01974  aux_bce_loss_1: 0.06401  aux_dice_loss_1: 0.04702  rg_l1_loss_1: 0.01246  aux_bce_loss_2: 0.04438  aux_dice_loss_2: 0.03201  rg_l1_loss_2: 0.01065  aux_bce_loss_3: 0.03638  aux_dice_loss_3: 0.02621  rg_l1_loss_3: 0.009924  aux_bce_loss_4: 0.03429  aux_dice_loss_4: 0.02602  rg_l1_loss_4: 0.008654  focal_loss_0: 0.01182  focal_loss_1: 0.007737  focal_loss_2: 0.007756  bbox_loss: 0.03426  time: 0.6966  data_time: 0.0084  lr: 0.001  max_mem: 2107M
[12/22 22:02:35] d2.utils.events INFO:  eta: 0:00:41  iter: 139  roi_cover_ratio: 0.6696  cls_acc: 0.9863  fg_cls_acc: 1  false_neg_ratio: 0  total_loss: 0.5953  aux_bce_loss_0: 0.111  aux_dice_loss_0: 0.08153  rg_l1_loss_0: 0.0181  aux_bce_loss_1: 0.06081  aux_dice_loss_1: 0.04393  rg_l1_loss_1: 0.01137  aux_bce_loss_2: 0.04012  aux_dice_loss_2: 0.02907  rg_l1_loss_2: 0.009984  aux_bce_loss_3: 0.03237  aux_dice_loss_3: 0.02346  rg_l1_loss_3: 0.009321  aux_bce_loss_4: 0.03093  aux_dice_loss_4: 0.02322  rg_l1_loss_4: 0.008193  focal_loss_0: 0.0125  focal_loss_1: 0.007994  focal_loss_2: 0.007645  bbox_loss: 0.03204  time: 0.6951  data_time: 0.0096  lr: 0.0001  max_mem: 2107M
[12/22 22:02:49] d2.utils.events INFO:  eta: 0:00:27  iter: 159  roi_cover_ratio: 0.7097  cls_acc: 0.9873  fg_cls_acc: 1  false_neg_ratio: 0  total_loss: 0.5906  aux_bce_loss_0: 0.1101  aux_dice_loss_0: 0.08054  rg_l1_loss_0: 0.01788  aux_bce_loss_1: 0.06051  aux_dice_loss_1: 0.04337  rg_l1_loss_1: 0.01157  aux_bce_loss_2: 0.03933  aux_dice_loss_2: 0.02891  rg_l1_loss_2: 0.009906  aux_bce_loss_3: 0.03153  aux_dice_loss_3: 0.02357  rg_l1_loss_3: 0.009471  aux_bce_loss_4: 0.0302  aux_dice_loss_4: 0.02337  rg_l1_loss_4: 0.008161  focal_loss_0: 0.01063  focal_loss_1: 0.007124  focal_loss_2: 0.00682  bbox_loss: 0.03171  time: 0.6945  data_time: 0.0088  lr: 0.0001  max_mem: 2108M
[12/22 22:03:03] d2.utils.events INFO:  eta: 0:00:13  iter: 179  roi_cover_ratio: 0.7564  cls_acc: 0.9863  fg_cls_acc: 1  false_neg_ratio: 0  total_loss: 0.5905  aux_bce_loss_0: 0.1097  aux_dice_loss_0: 0.08112  rg_l1_loss_0: 0.01742  aux_bce_loss_1: 0.05845  aux_dice_loss_1: 0.04314  rg_l1_loss_1: 0.01164  aux_bce_loss_2: 0.03995  aux_dice_loss_2: 0.02854  rg_l1_loss_2: 0.009809  aux_bce_loss_3: 0.03249  aux_dice_loss_3: 0.02312  rg_l1_loss_3: 0.009261  aux_bce_loss_4: 0.03128  aux_dice_loss_4: 0.02313  rg_l1_loss_4: 0.008095  focal_loss_0: 0.01074  focal_loss_1: 0.007471  focal_loss_2: 0.007231  bbox_loss: 0.03077  time: 0.6936  data_time: 0.0083  lr: 0.0001  max_mem: 2108M
[12/22 22:03:17] fvcore.common.checkpoint INFO: Saving checkpoint to output/vitb/fish_10shot/model_0000199.pth
[12/22 22:03:17] fvcore.common.checkpoint INFO: Saving checkpoint to output/vitb/fish_10shot/model_final.pth
[12/22 22:03:18] d2.utils.events INFO:  eta: 0:00:00  iter: 199  roi_cover_ratio: 0.7078  cls_acc: 0.9873  fg_cls_acc: 1  false_neg_ratio: 0  total_loss: 0.582  aux_bce_loss_0: 0.1108  aux_dice_loss_0: 0.08114  rg_l1_loss_0: 0.01723  aux_bce_loss_1: 0.05965  aux_dice_loss_1: 0.04285  rg_l1_loss_1: 0.01132  aux_bce_loss_2: 0.03923  aux_dice_loss_2: 0.0285  rg_l1_loss_2: 0.009866  aux_bce_loss_3: 0.03101  aux_dice_loss_3: 0.02316  rg_l1_loss_3: 0.009272  aux_bce_loss_4: 0.02912  aux_dice_loss_4: 0.02252  rg_l1_loss_4: 0.007995  focal_loss_0: 0.01118  focal_loss_1: 0.007039  focal_loss_2: 0.006675  bbox_loss: 0.03189  time: 0.6931  data_time: 0.0087  lr: 1e-05  max_mem: 2108M
[12/22 22:03:18] d2.engine.hooks INFO: Overall training speed: 198 iterations in 0:02:17 (0.6931 s / it)
[12/22 22:03:18] d2.engine.hooks INFO: Total training time: 0:02:19 (0:00:01 on hooks)
[12/22 22:03:18] d2.data.datasets.coco INFO: Loaded 909 images in COCO format from datasets/FISH/annotations/test.json
[12/22 22:03:18] d2.data.build INFO: Distribution of instances among all 1 categories:
[36m|  category  | #instances   |
|:----------:|:-------------|
|    fish    | 3029         |
|            |              |[0m
[12/22 22:03:18] d2.data.dataset_mapper INFO: [DatasetMapper] Augmentations used in inference: [ResizeShortestEdge(short_edge_length=(800, 800), max_size=1333, sample_style='choice')]
[12/22 22:03:18] d2.data.common INFO: Serializing 909 elements to byte tensors and concatenating them all ...
[12/22 22:03:18] d2.data.common INFO: Serialized dataset takes 0.35 MiB
[12/22 22:03:18] d2.evaluation.evaluator INFO: Start inference on 228 batches
[12/22 22:03:39] d2.evaluation.evaluator INFO: Inference done 11/228. Dataloading: 0.0013 s / iter. Inference: 0.1865 s / iter. Eval: 0.0003 s / iter. Total: 0.1880 s / iter. ETA=0:00:40
[12/22 22:03:44] d2.evaluation.evaluator INFO: Inference done 38/228. Dataloading: 0.0015 s / iter. Inference: 0.1892 s / iter. Eval: 0.0002 s / iter. Total: 0.1910 s / iter. ETA=0:00:36
[12/22 22:03:49] d2.evaluation.evaluator INFO: Inference done 61/228. Dataloading: 0.0017 s / iter. Inference: 0.2013 s / iter. Eval: 0.0002 s / iter. Total: 0.2033 s / iter. ETA=0:00:33
[12/22 22:03:55] d2.evaluation.evaluator INFO: Inference done 80/228. Dataloading: 0.0017 s / iter. Inference: 0.2178 s / iter. Eval: 0.0002 s / iter. Total: 0.2199 s / iter. ETA=0:00:32
[12/22 22:04:00] d2.evaluation.evaluator INFO: Inference done 96/228. Dataloading: 0.0017 s / iter. Inference: 0.2343 s / iter. Eval: 0.0003 s / iter. Total: 0.2364 s / iter. ETA=0:00:31
[12/22 22:04:05] d2.evaluation.evaluator INFO: Inference done 118/228. Dataloading: 0.0018 s / iter. Inference: 0.2329 s / iter. Eval: 0.0003 s / iter. Total: 0.2350 s / iter. ETA=0:00:25
[12/22 22:04:10] d2.evaluation.evaluator INFO: Inference done 141/228. Dataloading: 0.0018 s / iter. Inference: 0.2316 s / iter. Eval: 0.0003 s / iter. Total: 0.2336 s / iter. ETA=0:00:20
[12/22 22:04:15] d2.evaluation.evaluator INFO: Inference done 159/228. Dataloading: 0.0018 s / iter. Inference: 0.2371 s / iter. Eval: 0.0002 s / iter. Total: 0.2392 s / iter. ETA=0:00:16
[12/22 22:04:20] d2.evaluation.evaluator INFO: Inference done 174/228. Dataloading: 0.0018 s / iter. Inference: 0.2459 s / iter. Eval: 0.0003 s / iter. Total: 0.2480 s / iter. ETA=0:00:13
[12/22 22:04:25] d2.evaluation.evaluator INFO: Inference done 189/228. Dataloading: 0.0018 s / iter. Inference: 0.2533 s / iter. Eval: 0.0003 s / iter. Total: 0.2554 s / iter. ETA=0:00:09
[12/22 22:04:30] d2.evaluation.evaluator INFO: Inference done 204/228. Dataloading: 0.0018 s / iter. Inference: 0.2598 s / iter. Eval: 0.0003 s / iter. Total: 0.2619 s / iter. ETA=0:00:06
[12/22 22:04:35] d2.evaluation.evaluator INFO: Inference done 219/228. Dataloading: 0.0018 s / iter. Inference: 0.2660 s / iter. Eval: 0.0003 s / iter. Total: 0.2681 s / iter. ETA=0:00:02
[12/22 22:04:59] d2.evaluation.evaluator INFO: Total inference time: 0:01:20.510739 (0.361035 s / iter per device, on 4 devices)
[12/22 22:04:59] d2.evaluation.evaluator INFO: Total inference pure compute time: 0:01:00 (0.269093 s / iter per device, on 4 devices)
[12/22 22:04:59] d2.evaluation.coco_evaluation INFO: Preparing results for COCO format ...
[12/22 22:04:59] d2.evaluation.coco_evaluation INFO: Saving results to output/vitb/fish_10shot/inference/coco_instances_results.json
[12/22 22:04:59] d2.evaluation.coco_evaluation INFO: Evaluating predictions with unofficial COCO API...
[12/22 22:05:00] d2.evaluation.fast_eval_api INFO: Evaluate annotation type *bbox*
[12/22 22:05:00] d2.evaluation.fast_eval_api INFO: COCOeval_opt.evaluate() finished in 0.24 seconds.
[12/22 22:05:00] d2.evaluation.fast_eval_api INFO: Accumulating evaluation results...
[12/22 22:05:00] d2.evaluation.fast_eval_api INFO: COCOeval_opt.accumulate() finished in 0.07 seconds.
[12/22 22:05:00] d2.evaluation.coco_evaluation INFO: Evaluation results for bbox: 
|   AP   |  AP50  |  AP75  |  APs  |  APm   |  APl   |
|:------:|:------:|:------:|:-----:|:------:|:------:|
| 19.643 | 46.364 | 12.308 | 0.167 | 11.478 | 31.378 |
[12/22 22:05:00] d2.engine.defaults INFO: Evaluation results for FISH_test in csv format:
[12/22 22:05:00] d2.evaluation.testing INFO: copypaste: Task: bbox
[12/22 22:05:00] d2.evaluation.testing INFO: copypaste: AP,AP50,AP75,APs,APm,APl
[12/22 22:05:00] d2.evaluation.testing INFO: copypaste: 19.6435,46.3639,12.3075,0.1672,11.4781,31.3784
[12/22 22:05:00] d2.evaluation.testing INFO: ###################### ('AP', 19.64348018821379) ######################
[12/23 19:59:39] detectron2 INFO: Rank of current process: 0. World size: 4
[12/23 19:59:40] detectron2 INFO: Environment info:
----------------------  ----------------------------------------------------------------------------------------------
sys.platform            linux
Python                  3.9.23 | packaged by conda-forge | (main, Jun  4 2025, 17:57:12) [GCC 13.3.0]
numpy                   1.22.4
detectron2              RegionCLIP @/data2/user/2025/flf/project_zyh/CDFSOD-benchmark/tools/../detectron2
Compiler                GCC 10.5
CUDA compiler           CUDA 11.8
detectron2 arch flags   8.6
DETECTRON2_ENV_MODULE   <not set>
PyTorch                 1.13.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torch
PyTorch debug build     False
GPU available           True
GPU 0,1,2,3             NVIDIA GeForce RTX 4090 (arch=8.9)
CUDA_HOME               /usr/local/cuda-11.8
Pillow                  9.5.0
torchvision             0.14.1+cu117 @/home/fee/sdb_flf/miniconda3/envs/cdfsod/lib/python3.9/site-packages/torchvision
torchvision arch flags  3.5, 5.0, 6.0, 7.0, 7.5, 8.0, 8.6
fvcore                  0.1.5.post20221221
iopath                  0.1.8
cv2                     Not found
----------------------  ----------------------------------------------------------------------------------------------
PyTorch built with:
  - GCC 9.3
  - C++ Version: 201402
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v2.6.0 (Git Hash 52b5f107dd9cf10910aaa19cb47f3abf9b349815)
  - OpenMP 201511 (a.k.a. OpenMP 4.5)
  - LAPACK is enabled (usually provided by MKL)
  - NNPACK is enabled
  - CPU capability usage: AVX2
  - CUDA Runtime 11.7
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_80,code=sm_80;-gencode;arch=compute_86,code=sm_86
  - CuDNN 8.9.7  (built against CUDA 11.8)
    - Built with CuDNN 8.5
  - Magma 2.6.1
  - Build settings: BLAS_INFO=mkl, BUILD_TYPE=Release, CUDA_VERSION=11.7, CUDNN_VERSION=8.5.0, CXX_COMPILER=/opt/rh/devtoolset-9/root/usr/bin/c++, CXX_FLAGS= -fabi-version=11 -Wno-deprecated -fvisibility-inlines-hidden -DUSE_PTHREADPOOL -fopenmp -DNDEBUG -DUSE_KINETO -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DSYMBOLICATE_MOBILE_DEBUG_HANDLE -DEDGE_PROFILER_USE_KINETO -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Werror=non-virtual-dtor -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wunused-local-typedefs -Wno-unused-parameter -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-psabi -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Werror=cast-function-type -Wno-stringop-overflow, LAPACK_INFO=mkl, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, TORCH_VERSION=1.13.1, USE_CUDA=ON, USE_CUDNN=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_ROCM=OFF, 

[12/23 19:59:40] detectron2 INFO: Command line arguments: Namespace(config_file='configs/fish/vitb_shot10_fish_finetune.yaml', resume=False, eval_only=True, num_gpus=4, controller=False, num_machines=1, machine_rank=0, dist_url='auto', opts=['MODEL.WEIGHTS', 'output/vitb/fish_10shot/model_final.pth', 'DE.OFFLINE_RPN_CONFIG', 'configs/RPN/mask_rcnn_R_50_C4_1x_ovd_FSD.yaml', 'OUTPUT_DIR', 'output/vitb/fish_10shot/', 'SOLVER.IMS_PER_BATCH', '4', 'INPUT.MIN_SIZE_TEST', '600', 'INPUT.MAX_SIZE_TEST', '1000'])
[12/23 19:59:40] detectron2 INFO: Contents of args.config_file=configs/fish/vitb_shot10_fish_finetune.yaml:
_BASE_: ../Base-RCNN-C4.yaml
DE:
  CLASS_PROTOTYPES: prototypes_init/FISH_10shot.vitb14.bbox.p10.sk.pkl
  BG_PROTOTYPES: weights/initial/background/background_prototypes.vitb14.pth
  BG_CLS_LOSS_WEIGHT: 0.2
  TOPK: 1
  SET_CD_VITO: true
  ATTN_FUSE_RATIO: 0.7
MODEL:
  META_ARCHITECTURE: OpenSetDetectorWithExamples
  BACKBONE:
    NAME: build_dino_v2_vit
    TYPE: base    # base, small
  WEIGHTS: ''
  MASK_ON: false
  RPN:
    HEAD_NAME: StandardRPNHead
    IN_FEATURES: [res4]
  ROI_HEADS:
    SCORE_THRESH_TEST: 0.001
  ROI_BOX_HEAD:
    NAME: ''
    NUM_FC: 0
    POOLER_RESOLUTION: 7
    CLS_AGNOSTIC_BBOX_REG: true
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
DATASETS:
  TRAIN: ("FISH_10shot",)
  TEST: ("FISH_test",)
TEST:
  EVAL_PERIOD: 200
SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.001
  STEPS: (120, 180)
  MAX_ITER: 200
  WARMUP_ITERS: 100
  CHECKPOINT_PERIOD: 200
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: RGB


[12/23 19:59:40] detectron2 INFO: Full config saved to output/vitb/fish_10shot/config.yaml
[12/23 19:59:46] fvcore.common.checkpoint INFO: [Checkpointer] Loading from output/vitb/fish_10shot/model_final.pth ...
[12/23 19:59:55] d2.data.datasets.coco INFO: Loaded 909 images in COCO format from datasets/FISH/annotations/test.json
[12/23 19:59:55] d2.data.build INFO: Distribution of instances among all 1 categories:
|  category  | #instances   |
|:----------:|:-------------|
|    fish    | 3029         |
|            |              |
[12/23 19:59:55] d2.data.dataset_mapper INFO: [DatasetMapper] Augmentations used in inference: [ResizeShortestEdge(short_edge_length=(600, 600), max_size=1000, sample_style='choice')]
[12/23 19:59:55] d2.data.common INFO: Serializing 909 elements to byte tensors and concatenating them all ...
[12/23 19:59:55] d2.data.common INFO: Serialized dataset takes 0.35 MiB
[12/23 19:59:55] d2.evaluation.evaluator INFO: Start inference on 228 batches
[12/23 20:00:18] d2.evaluation.evaluator INFO: Inference done 11/228. Dataloading: 0.0008 s / iter. Inference: 0.2694 s / iter. Eval: 0.0003 s / iter. Total: 0.2705 s / iter. ETA=0:00:58
[12/23 20:00:23] d2.evaluation.evaluator INFO: Inference done 28/228. Dataloading: 0.0015 s / iter. Inference: 0.2935 s / iter. Eval: 0.0077 s / iter. Total: 0.3029 s / iter. ETA=0:01:00
[12/23 20:00:28] d2.evaluation.evaluator INFO: Inference done 43/228. Dataloading: 0.0015 s / iter. Inference: 0.3136 s / iter. Eval: 0.0048 s / iter. Total: 0.3199 s / iter. ETA=0:00:59
[12/23 20:00:33] d2.evaluation.evaluator INFO: Inference done 57/228. Dataloading: 0.0014 s / iter. Inference: 0.3257 s / iter. Eval: 0.0036 s / iter. Total: 0.3308 s / iter. ETA=0:00:56
[12/23 20:00:39] d2.evaluation.evaluator INFO: Inference done 71/228. Dataloading: 0.0014 s / iter. Inference: 0.3374 s / iter. Eval: 0.0029 s / iter. Total: 0.3418 s / iter. ETA=0:00:53
[12/23 20:00:44] d2.evaluation.evaluator INFO: Inference done 86/228. Dataloading: 0.0014 s / iter. Inference: 0.3399 s / iter. Eval: 0.0024 s / iter. Total: 0.3437 s / iter. ETA=0:00:48
[12/23 20:00:49] d2.evaluation.evaluator INFO: Inference done 101/228. Dataloading: 0.0014 s / iter. Inference: 0.3400 s / iter. Eval: 0.0021 s / iter. Total: 0.3435 s / iter. ETA=0:00:43
[12/23 20:00:54] d2.evaluation.evaluator INFO: Inference done 115/228. Dataloading: 0.0014 s / iter. Inference: 0.3442 s / iter. Eval: 0.0018 s / iter. Total: 0.3475 s / iter. ETA=0:00:39
[12/23 20:01:00] d2.evaluation.evaluator INFO: Inference done 130/228. Dataloading: 0.0013 s / iter. Inference: 0.3446 s / iter. Eval: 0.0016 s / iter. Total: 0.3477 s / iter. ETA=0:00:34
[12/23 20:01:05] d2.evaluation.evaluator INFO: Inference done 145/228. Dataloading: 0.0013 s / iter. Inference: 0.3438 s / iter. Eval: 0.0015 s / iter. Total: 0.3467 s / iter. ETA=0:00:28
[12/23 20:01:10] d2.evaluation.evaluator INFO: Inference done 159/228. Dataloading: 0.0013 s / iter. Inference: 0.3462 s / iter. Eval: 0.0014 s / iter. Total: 0.3491 s / iter. ETA=0:00:24
[12/23 20:01:15] d2.evaluation.evaluator INFO: Inference done 174/228. Dataloading: 0.0013 s / iter. Inference: 0.3456 s / iter. Eval: 0.0013 s / iter. Total: 0.3484 s / iter. ETA=0:00:18
[12/23 20:01:20] d2.evaluation.evaluator INFO: Inference done 189/228. Dataloading: 0.0014 s / iter. Inference: 0.3451 s / iter. Eval: 0.0012 s / iter. Total: 0.3478 s / iter. ETA=0:00:13
[12/23 20:01:25] d2.evaluation.evaluator INFO: Inference done 204/228. Dataloading: 0.0014 s / iter. Inference: 0.3446 s / iter. Eval: 0.0012 s / iter. Total: 0.3472 s / iter. ETA=0:00:08
[12/23 20:01:30] d2.evaluation.evaluator INFO: Inference done 219/228. Dataloading: 0.0014 s / iter. Inference: 0.3441 s / iter. Eval: 0.0011 s / iter. Total: 0.3467 s / iter. ETA=0:00:03
[12/23 20:01:53] d2.evaluation.evaluator INFO: Total inference time: 0:01:37.258825 (0.436138 s / iter per device, on 4 devices)
[12/23 20:01:53] d2.evaluation.evaluator INFO: Total inference pure compute time: 0:01:16 (0.343842 s / iter per device, on 4 devices)
[12/23 20:01:57] d2.evaluation.coco_evaluation INFO: Preparing results for COCO format ...
[12/23 20:01:57] d2.evaluation.coco_evaluation INFO: Saving results to output/vitb/fish_10shot/inference/coco_instances_results.json
[12/23 20:01:57] d2.evaluation.coco_evaluation INFO: Evaluating predictions with unofficial COCO API...
[12/23 20:01:57] d2.evaluation.fast_eval_api INFO: Evaluate annotation type *bbox*
[12/23 20:01:58] d2.evaluation.fast_eval_api INFO: COCOeval_opt.evaluate() finished in 0.31 seconds.
[12/23 20:01:58] d2.evaluation.fast_eval_api INFO: Accumulating evaluation results...
[12/23 20:01:58] d2.evaluation.fast_eval_api INFO: COCOeval_opt.accumulate() finished in 0.07 seconds.
[12/23 20:01:58] d2.evaluation.coco_evaluation INFO: Evaluation results for bbox: 
|   AP   |  AP50  |  AP75  |  APs  |  APm  |  APl   |
|:------:|:------:|:------:|:-----:|:-----:|:------:|
| 17.371 | 44.455 | 8.902  | 0.047 | 8.512 | 29.868 |
[12/23 20:01:58] d2.engine.defaults INFO: Evaluation results for FISH_test in csv format:
[12/23 20:01:58] d2.evaluation.testing INFO: copypaste: Task: bbox
[12/23 20:01:58] d2.evaluation.testing INFO: copypaste: AP,AP50,AP75,APs,APm,APl
[12/23 20:01:58] d2.evaluation.testing INFO: copypaste: 17.3709,44.4550,8.9016,0.0473,8.5122,29.8680
[12/23 20:01:58] d2.evaluation.testing INFO: ###################### ('AP', 17.37085707858401) ######################
